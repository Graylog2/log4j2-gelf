<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Log4j2-gelf by Graylog2</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Log4j2-gelf</h1>
        <p>GELF Appender for Apache Log4j 2</p>

        <p class="view"><a href="https://github.com/Graylog2/log4j2-gelf">View the Project on GitHub <small>Graylog2/log4j2-gelf</small></a></p>


        <ul>
          <li><a href="https://github.com/Graylog2/log4j2-gelf/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Graylog2/log4j2-gelf/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Graylog2/log4j2-gelf">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="gelf-appender-for-apache-log4j-2" class="anchor" href="#gelf-appender-for-apache-log4j-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GELF Appender for Apache Log4j 2</h1>

<p><a href="LICENSE.txt"><img src="https://img.shields.io/github/license/Graylog2/log4j2-gelf.svg?maxAge=2592000" alt="License"></a>
<a href="https://travis-ci.org/Graylog2/log4j2-gelf"><img src="https://travis-ci.org/Graylog2/log4j2-gelf.svg?branch=master" alt="Build Status"></a>
<a href="http://mvnrepository.com/artifact/org.graylog2.log4j2/log4j2-gelf"><img src="https://img.shields.io/maven-central/v/org.graylog2.log4j2/log4j2-gelf.svg?maxAge=2592000" alt="Maven Central"></a></p>

<p>This appender for <a href="https://logging.apache.org/log4j/2.x/">Apache Log4j 2</a> logs messages to a GELF server like <a href="http://www.graylog2.org">Graylog2</a> or <a href="http://logstash.net">logstash</a>.</p>

<p>It's using the official <a href="https://graylog2.github.io/gelfclient/">GELF Java client</a> to connect to a remote server.</p>

<p>You can specify the following parameters for the GELF appender in the <code>log4j2.xml</code> configuration file:</p>

<ul>
<li>
<code>name</code>

<ul>
<li>The reference name of the Appender</li>
</ul>
</li>
<li>
<code>server</code> (default: <code>localhost</code>)

<ul>
<li>The host name or IP address of the GELF server</li>
</ul>
</li>
<li>
<code>port</code> (default: <code>12201</code>)

<ul>
<li>The port the GELF server is listening on</li>
</ul>
</li>
<li>
<code>hostName</code> (default: the local host name or <code>localhost</code> if it couldn't be detected)

<ul>
<li>The host name of the machine generating the logs</li>
</ul>
</li>
<li>
<code>protocol</code> (default: <code>UDP</code>)

<ul>
<li>The transport protocol to use</li>
</ul>
</li>
<li>
<code>tlsEnabled</code> (default: <code>false</code>)

<ul>
<li>Whether TLS should be enabled</li>
</ul>
</li>
<li>
<code>tlsEnableCertificateVerification</code> (default: <code>true</code>)

<ul>
<li>Whether the TLS certificate chain should be checked</li>
</ul>
</li>
<li>
<code>tlsTrustCertChainFilename</code>  (default: empty)

<ul>
<li>A X.509 certificate chain file in PEM format for certificate verification</li>
</ul>
</li>
<li>
<code>includeSource</code> (default: <code>true</code>)

<ul>
<li>Whether the source of the log message should be included</li>
</ul>
</li>
<li>
<code>includeThreadContext</code> (default: <code>true</code>)

<ul>
<li>Whether the contents of the <a href="https://logging.apache.org/log4j/2.x/manual/thread-context.html">ThreadContext</a> should be included</li>
</ul>
</li>
<li>
<code>includeStackTrace</code> (default: <code>true</code>)

<ul>
<li>Whether a full stack trace should be included</li>
</ul>
</li>
<li>
<code>includeExceptionCause</code> (default: <code>false</code>)

<ul>
<li>Whether the included stack trace should contain causing exceptions</li>
</ul>
</li>
<li>
<code>queueSize</code> (default: <code>512</code>)

<ul>
<li>The size of the internally used queue</li>
</ul>
</li>
<li>
<code>connectTimeout</code> (default: <code>1000</code>)

<ul>
<li>The connection timeout for TCP connections in milliseconds</li>
</ul>
</li>
<li>
<code>reconnectDelay</code> (default: <code>500</code>)

<ul>
<li>The time to wait between reconnects in milliseconds</li>
</ul>
</li>
<li>
<code>sendBufferSize</code> (default: <code>-1</code>)

<ul>
<li>The size of the socket send buffer in bytes. A size of -1 deactivates the send buffer</li>
</ul>
</li>
<li>
<code>tcpNoDelay</code> (default: <code>false</code>)

<ul>
<li>Whether Nagle's algorithm should be used for TCP connections</li>
</ul>
</li>
<li>
<code>tcpKeepAlive</code> (default: <code>false</code>)

<ul>
<li>Whether to try keeping alive TCP connections.</li>
</ul>
</li>
<li>
<code>Filter</code> elements

<ul>
<li>A <a href="https://logging.apache.org/log4j/2.x/manual/filters.html">Filter</a> to determine if the event should be handled by this Appender</li>
</ul>
</li>
<li>
<code>Layout</code> element (default: none)

<ul>
<li>The <a href="https://logging.apache.org/log4j/2.x/manual/layouts.html">Layout</a> used to format the LogEvent</li>
</ul>
</li>
<li>
<code>ignoreExceptions</code>

<ul>
<li>The default is <code>true</code>, causing exceptions encountered while appending events to be internally logged and then ignored. When set to <code>false</code> exceptions will be propagated to the caller, instead. Must be set to <code>false</code> when wrapping this Appender in a <code>FailoverAppender</code>.</li>
</ul>
</li>
<li>Additional Fields

<ul>
<li>Additional fields can be added with <code>KeyValuePair</code> elements inside the <code>GELF</code> element.</li>
</ul>
</li>
</ul>

<h2>
<a id="log4j2xml-example" class="anchor" href="#log4j2xml-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>log4j2.xml example</h2>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="OFF" packages="org.graylog2.log4j2"&gt;
    &lt;Appenders&gt;
        &lt;GELF name="gelfAppender" server="graylog2.example.com" port="12201" hostName="appserver01.example.com"&gt;
            &lt;PatternLayout pattern="%logger{36} - %msg%n"/&gt;
            &lt;Filters&gt;
                &lt;Filter type="MarkerFilter" marker="FLOW" onMatch="DENY" onMismatch="NEUTRAL"/&gt;
                &lt;Filter type="MarkerFilter" marker="EXCEPTION" onMatch="DENY" onMismatch="ACCEPT"/&gt;
            &lt;/Filters&gt;
            &lt;!-- Additional fields --&gt;
            &lt;KeyValuePair key="foo" value="bar"/&gt;
            &lt;KeyValuePair key="jvm" value="${java:vm}"/&gt;                
        &lt;/GELF&gt;
    &lt;/Appenders&gt;
    &lt;Loggers&gt;
        &lt;Root level="info"&gt;
            &lt;AppenderRef ref="gelfAppender"/&gt;
        &lt;/Root&gt;
    &lt;/Loggers&gt;
&lt;/Configuration&gt;
</code></pre>

<h2>
<a id="java-code-example" class="anchor" href="#java-code-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java code example</h2>

<pre><code>Logger logger = LogManager.getLogger("test");
ThreadContext.put("userId", "testUser");
logger.info("Hello World");
</code></pre>

<h2>
<a id="using-variables-in-the-additional-fields" class="anchor" href="#using-variables-in-the-additional-fields" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using variables in the additional fields</h2>

<p>The additional fields (<code>KeyValuePair</code> elements) can contain references to variables. </p>

<p>In order for Log4j 2.x to resolve the variable's value, the variable name must have a certain prefix depending on how the variable is provided.</p>

<p>Internally we're making use of Log4j's <a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/StrSubstitutor.html">StrSubstitutor</a> to resolve the variable's value. </p>

<p>This in turn is utilizing the following <a href="https://logging.apache.org/log4j/2.x/manual/lookups.html">Log4j Lookups</a> with the prefixes in the following list:</p>

<table>
<thead>
<tr>
<th>Prefix</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ctx</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/ContextMapLookup.html">ContextMapLookup</a></td>
</tr>
<tr>
<td><code>bundle</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/ResourceBundleLookup.html">ResourceBundleLookup</a></td>
</tr>
<tr>
<td><code>date</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/DateLookup.html">DateLookup</a></td>
</tr>
<tr>
<td><code>env</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/EnvironmentLookup.html">EnvironmentLookup</a></td>
</tr>
<tr>
<td><code>java</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/JavaLookup.html">JavaLookup</a></td>
</tr>
<tr>
<td><code>jndi</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/JndiLookup.html">JndiLookup</a></td>
</tr>
<tr>
<td><code>jvmrunargs</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/JmxRuntimeInputArgumentsLookup.html">JmxRuntimeInputArgumentsLookup</a></td>
</tr>
<tr>
<td><code>map</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/MapLookup.html">MapLookup</a></td>
</tr>
<tr>
<td><code>sd</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/StructuredDataLookup.html">StructuredDataLookup</a></td>
</tr>
<tr>
<td><code>sys</code></td>
<td><a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/lookup/SystemPropertiesLookup.html">SystemPropertiesLookup</a></td>
</tr>
</tbody>
</table>

<p>Please read up on the different variable handling in the linked Javadocs.</p>

<h3>
<a id="example-configuration-with-variables" class="anchor" href="#example-configuration-with-variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example configuration with variables</h3>

<pre><code>&lt;GELF name="gelfAppender" server="graylog2.example.com" port="12201" hostName="appserver01.example.com"&gt;
    &lt;KeyValuePair key="user" value="${env:USER}"/&gt;
    &lt;KeyValuePair key="CLIargument" value="${sys:cliargument}"/&gt;
    &lt;KeyValuePair key="jvm" value="${java:vm}"/&gt;
    &lt;KeyValuePair key="fileEncoding" value="${sys:file.encoding}"/&gt;
&lt;/GELF&gt;
</code></pre>

<h1>
<a id="versions" class="anchor" href="#versions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Versions</h1>

<table>
<thead>
<tr>
<th>GELF Appender for Apache Log4j 2</th>
<th>Release date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0</td>
<td>29-Sep-2014</td>
</tr>
<tr>
<td>1.0.1</td>
<td>21-Oct-2014</td>
</tr>
<tr>
<td>1.0.2</td>
<td>09-Feb-2015</td>
</tr>
<tr>
<td>1.0.3</td>
<td>11-Feb-2015</td>
</tr>
<tr>
<td>1.1.0</td>
<td>16-Jul-2015</td>
</tr>
<tr>
<td>1.2.0</td>
<td>18-Jul-2016</td>
</tr>
<tr>
<td>1.2.1</td>
<td>11-Aug-2016</td>
</tr>
<tr>
<td>1.3.0</td>
<td>24-Aug-2016</td>
</tr>
</tbody>
</table>

<p>This appender uses GELF Java client 1.4.0.</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h1>

<p>Maven coordinates</p>

<pre><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.graylog2.log4j2&lt;/groupId&gt;
        &lt;artifactId&gt;log4j2-gelf&lt;/artifactId&gt;
        &lt;version&gt;1.3.0&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h1>

<p>GELF Appender for Apache Log4j 2</p>

<p>Copyright (C) 2014 TORCH GmbH; 2015-2016 Graylog, Inc.</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/Graylog2">Graylog2</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
